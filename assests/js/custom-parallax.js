;(function($,window){'use strict';window['kartra']=('undefined'===typeof window['kartra']?[]:window['kartra']);if(window['kartra']['customParallax'])return false;window['kartra']['customParallax']=('undefined'===typeof window['kartra']['customParallax']?[]:window['kartra']['customParallax']);var $parallaxElements=$('.kartra_parallax_background'),$window=$(window),imageLoaded=false,windowHeight;function applyParallax($element){if(true!==$element.data('has-paralllax')){$element.data('has-paralllax');if($element.css('background-image')!=='none'){getBackgroundSize($element,function(w,h){$element.data('parallax-sizes',{'width':w,'height':h});onWindowResize();if(false===imageLoaded){$window.on('scroll',onWindowScroll);$window.on('resize',onWindowResize);imageLoaded=true;}});}}}
function getBackgroundSize($el,callback){var img=new Image(),width,height,backgroundSize;img.src=$el.css('background-image').replace(/url\(['"]*(.*?)['"]*\)/g,'$1');img.onload=function(){backgroundSize=$el.css('background-size').split(' ');if(/px/.test(backgroundSize[0]))width=parseInt(backgroundSize[0]);if(/px/.test(backgroundSize[1]))height=parseInt(backgroundSize[1]);if(/%/.test(backgroundSize[0]))width=$el.parent().width()*(parseInt(backgroundSize[0])/100);if(/%/.test(backgroundSize[1]))height=$el.parent().height()*(parseInt(backgroundSize[0])/100);if(typeof width=='undefined')width=this.width;if(typeof height=='undefined')height=this.height;callback(width,height);};}
function onWindowResize(){windowHeight=$window.height();onWindowScroll();}
function onWindowScroll(){$parallaxElements.each(function(i,parallax){var $parallax=$(parallax),current=windowHeight-($parallax.closest('.content').position().top-$window.scrollTop()),begin=0,end=windowHeight+$parallax.height(),sizes=$parallax.data('parallax-sizes');if('undefined'!==typeof sizes){var backgroundImageRatio=sizes.width/sizes.height,visibleImageRatio=$parallax.width()/$parallax.height(),sizesRatio=visibleImageRatio/backgroundImageRatio;if(backgroundImageRatio&&current>begin&&current<end){var ratioThreshold=1.3;var percent=100-Math.round(current/end*100);if(sizesRatio>ratioThreshold){var newPercent=100/sizesRatio;percent=Math.round((100-newPercent)/2+percent*newPercent/100);$parallax.css('background-size','cover');$parallax.css('background-position-y',percent+'%');}else{var ratioThresholdPercent=(ratioThreshold*100)+'%';$parallax.css('background-size','auto '+ratioThresholdPercent);$parallax.css('background-position-y',percent+'%');}}}});}
window.kartra.customParallax={applyCustomParallax:applyParallax};})(jQuery,window);